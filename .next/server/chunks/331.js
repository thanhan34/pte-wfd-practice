"use strict";exports.id=331,exports.ids=[331],exports.modules={4780:(a,b,c)=>{function d(a,b){let c=a=>a.trim().toLowerCase().replace(/\s+/g," "),d=c(a),e=c(b),f=d.split(" ").filter(a=>a.length>0),g=e.split(" ").filter(a=>a.length>0),h=[],i=[],j=[],k=[],l=new Map,m=new Map;f.forEach(a=>{l.set(a,(l.get(a)||0)+1)}),g.forEach(a=>{m.set(a,(m.get(a)||0)+1)}),l.forEach((a,b)=>{let c=Math.min(a,m.get(b)||0);for(let a=0;a<c;a++)h.push(b)}),l.forEach((a,b)=>{let c=Math.max(0,a-(m.get(b)||0));for(let a=0;a<c;a++)j.push(b)}),m.forEach((a,b)=>{let c=Math.max(0,a-(l.get(b)||0));for(let a=0;a<c;a++)k.push(b)}),g.forEach(a=>{l.has(a)||i.push(a)});let n=f.length,o=h.length,p=0===j.length&&0===i.length&&0===k.length;return{correct:h,incorrect:i,missing:j,extra:k,isFullyCorrect:p,accuracy:Math.round(100*(n>0?o/n*100:0))/100}}function e(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b="";for(let c=0;c<6;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b}function f(a){return a.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function g(a){return"submitted"===a.status?a.accuracy?.isFullyCorrect?"correct":"incorrect":a.status}function h(a,b){let c;return(...d)=>{clearTimeout(c),c=setTimeout(()=>a(...d),b)}}c.d(b,{CD:()=>g,S:()=>e,cG:()=>d,fU:()=>f,sg:()=>h})},9331:(a,b,c)=>{c.r(b),c.d(b,{authenticateUser:()=>k,createRoom:()=>l,getCurrentUser:()=>s,joinRoom:()=>m,leaveRoom:()=>q,setTargetPhrase:()=>n,submitAnswer:()=>o,subscribeToRoom:()=>r,updateTypingStatus:()=>p});var d=c(4780);let e={},f=null,g={};function h(){}function i(){}function j(a){let b=e[a]||null;(g[a]||[]).forEach(a=>a(b))}async function k(){return h(),f||(f={id:"user_"+Math.random().toString(36).substr(2,9),nickname:"",isHost:!1,joinedAt:new Date},i()),f}async function l(a){let b=await k(),c=(0,d.S)(),f={id:c,hostId:b.id,targetPhrase:"",createdAt:new Date,isActive:!0,participants:{[b.id]:{nickname:a,status:"waiting",isTyping:!1,correctCount:0,totalAttempts:0}},isCountingDown:!1,currentPhraseIndex:0,shouldPlayAudio:!1};return e[c]=f,i(),j(c),c}async function m(a,b){let c=await k(),d=e[a];if(!d)throw Error("Room not found");if(!d.isActive)throw Error("Room is not active");d.participants[c.id]={nickname:b,status:"waiting",isTyping:!1,correctCount:0,totalAttempts:0},e[a]=d,j(a)}async function n(a,b){let c=await k(),d=e[a];if(!d)throw Error("Room not found");if(d.hostId!==c.id)throw Error("Only host can set target phrase");Object.keys(d.participants).forEach(a=>{let b=d.participants[a];d.participants[a]={...b,status:"waiting",isTyping:!1,submission:void 0,accuracy:void 0,submittedAt:void 0}}),d.targetPhrase=b,d.isCountingDown=!0,d.countdownStartedAt=new Date,e[a]=d,j(a),setTimeout(()=>{let b=e[a];b&&(b.isCountingDown=!1,b.roundStartTime=new Date,e[a]=b,j(a))},3e3)}async function o(a,b){let c=await k(),f=e[a];if(!f)throw Error("Room not found");let g=f.targetPhrase;if(!g)throw Error("No target phrase set");let h=(0,d.cG)(g,b),i=f.participants[c.id],l=h.isFullyCorrect?(i.correctCount||0)+1:i.correctCount||0,m=(i.totalAttempts||0)+1,n={};if(h.isFullyCorrect&&f.roundStartTime){let a=Date.now()-f.roundStartTime.getTime(),b=[...i.completionTimes||[],a];n={completionTimes:b,averageTime:b.reduce((a,b)=>a+b,0)/b.length,fastestTime:Math.min(...b)}}f.participants[c.id]={...f.participants[c.id],status:"submitted",submission:b,accuracy:h,submittedAt:new Date,isTyping:!1,correctCount:l,totalAttempts:m,...n},e[a]=f,j(a)}async function p(a,b){let c=await k(),d=e[a];if(!d)return;let f=d.participants[c.id];f&&"submitted"!==f.status&&(f.status=b?"typing":"waiting",f.isTyping=b,e[a]=d,j(a))}async function q(a){let b=await k(),c=e[a];c&&(delete c.participants[b.id],c.hostId===b.id&&(c.isActive=!1),e[a]=c,j(a))}function r(a,b){return h(),g[a]||(g[a]=[]),g[a].push(b),b(e[a]||null),()=>{g[a]&&(g[a]=g[a].filter(a=>a!==b))}}function s(){return h(),f}}};