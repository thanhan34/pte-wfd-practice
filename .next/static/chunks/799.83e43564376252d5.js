"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{4799:(t,e,r)=>{r.r(e),r.d(e,{authenticateUser:()=>g,createRoom:()=>f,getCurrentUser:()=>S,joinRoom:()=>d,leaveRoom:()=>y,setTargetPhrase:()=>p,submitAnswer:()=>m,subscribeToRoom:()=>T,updateTypingStatus:()=>w});var i=r(9434);let n="wfd_rooms",o="wfd_current_user",a={},s=null,c={};function u(){try{let t=localStorage.getItem(n);t&&(a=JSON.parse(t));let e=localStorage.getItem(o);e&&(s=JSON.parse(e))}catch(t){console.warn("Error loading from localStorage:",t)}}function l(){try{localStorage.setItem(n,JSON.stringify(a)),s&&localStorage.setItem(o,JSON.stringify(s))}catch(t){console.warn("Error saving to localStorage:",t)}}function h(t){let e=a[t]||null;(c[t]||[]).forEach(t=>t(e))}async function g(){return u(),s||(s={id:"user_"+Math.random().toString(36).substr(2,9),nickname:"",isHost:!1,joinedAt:new Date},l()),s}async function f(t){let e=await g(),r=(0,i.S)(),n={id:r,hostId:e.id,targetPhrase:"",createdAt:new Date,isActive:!0,participants:{[e.id]:{nickname:t,status:"waiting",isTyping:!1,correctCount:0,totalAttempts:0}},isCountingDown:!1,currentPhraseIndex:0,shouldPlayAudio:!1};return a[r]=n,l(),h(r),r}async function d(t,e){u();let r=await g(),i=a[t];if(!i)throw Error("Room not found");if(!i.isActive)throw Error("Room is not active");i.participants[r.id]={nickname:e,status:"waiting",isTyping:!1,correctCount:0,totalAttempts:0},a[t]=i,l(),h(t)}async function p(t,e){u();let r=await g(),i=a[t];if(!i)throw Error("Room not found");if(i.hostId!==r.id)throw Error("Only host can set target phrase");Object.keys(i.participants).forEach(t=>{let e=i.participants[t];i.participants[t]={...e,status:"waiting",isTyping:!1,submission:void 0,accuracy:void 0,submittedAt:void 0}}),i.targetPhrase=e,i.isCountingDown=!0,i.countdownStartedAt=new Date,a[t]=i,l(),h(t),setTimeout(()=>{let e=a[t];e&&(e.isCountingDown=!1,e.roundStartTime=new Date,a[t]=e,l(),h(t))},3e3)}async function m(t,e){u();let r=await g(),n=a[t];if(!n)throw Error("Room not found");let o=n.targetPhrase;if(!o)throw Error("No target phrase set");let s=(0,i.cG)(o,e),c=n.participants[r.id],f=s.isFullyCorrect?(c.correctCount||0)+1:c.correctCount||0,d=(c.totalAttempts||0)+1,p={};if(s.isFullyCorrect&&n.roundStartTime){let t=Date.now()-n.roundStartTime.getTime(),e=[...c.completionTimes||[],t];p={completionTimes:e,averageTime:e.reduce((t,e)=>t+e,0)/e.length,fastestTime:Math.min(...e)}}n.participants[r.id]={...n.participants[r.id],status:"submitted",submission:e,accuracy:s,submittedAt:new Date,isTyping:!1,correctCount:f,totalAttempts:d,...p},a[t]=n,l(),h(t)}async function w(t,e){u();let r=await g(),i=a[t];if(!i)return;let n=i.participants[r.id];n&&"submitted"!==n.status&&(n.status=e?"typing":"waiting",n.isTyping=e,a[t]=i,l(),h(t))}async function y(t){u();let e=await g(),r=a[t];r&&(delete r.participants[e.id],r.hostId===e.id&&(r.isActive=!1),a[t]=r,l(),h(t))}function T(t,e){return u(),c[t]||(c[t]=[]),c[t].push(e),e(a[t]||null),()=>{c[t]&&(c[t]=c[t].filter(t=>t!==e))}}function S(){return u(),s}},9434:(t,e,r)=>{function i(t,e){let r=t=>t.trim().toLowerCase().replace(/\s+/g," "),i=r(t),n=r(e),o=i.split(" ").filter(t=>t.length>0),a=n.split(" ").filter(t=>t.length>0),s=[],c=[],u=[],l=[],h=new Map,g=new Map;o.forEach(t=>{h.set(t,(h.get(t)||0)+1)}),a.forEach(t=>{g.set(t,(g.get(t)||0)+1)}),h.forEach((t,e)=>{let r=Math.min(t,g.get(e)||0);for(let t=0;t<r;t++)s.push(e)}),h.forEach((t,e)=>{let r=Math.max(0,t-(g.get(e)||0));for(let t=0;t<r;t++)u.push(e)}),g.forEach((t,e)=>{let r=Math.max(0,t-(h.get(e)||0));for(let t=0;t<r;t++)l.push(e)}),a.forEach(t=>{h.has(t)||c.push(t)});let f=o.length,d=s.length,p=0===u.length&&0===c.length&&0===l.length;return{correct:s,incorrect:c,missing:u,extra:l,isFullyCorrect:p,accuracy:Math.round(100*(f>0?d/f*100:0))/100}}function n(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let r=0;r<6;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function o(t){return t.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function a(t){if("submitted"===t.status){var e;return(null==(e=t.accuracy)?void 0:e.isFullyCorrect)?"correct":"incorrect"}return t.status}function s(t,e){let r;return function(){for(var i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];clearTimeout(r),r=setTimeout(()=>t(...n),e)}}r.d(e,{CD:()=>a,S:()=>n,cG:()=>i,fU:()=>o,sg:()=>s})}}]);