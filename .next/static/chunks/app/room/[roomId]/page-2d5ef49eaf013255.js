(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{988:(e,t,s)=>{"use strict";s.d(t,{HW:()=>p,JP:()=>u,Jx:()=>m,O3:()=>o,ab:()=>d,fp:()=>g,jy:()=>h,rh:()=>x});let r=!0,a=null,n=null;async function i(){try{let e=(a=await Promise.all([s.e(992),s.e(811),s.e(645),s.e(86)]).then(s.bind(s,9086))).authenticateUser(),t=new Promise((e,t)=>setTimeout(()=>t(Error("Firebase connection timeout")),1e4));await Promise.race([e,t]),r=!0,console.log("✅ Using Firebase for data storage")}catch(e){console.warn("⚠️ Firebase not available, using localStorage fallback:",e instanceof Error?e.message:"Unknown error"),r=!1,n=await s.e(799).then(s.bind(s,4799)),console.log("\uD83D\uDCE6 Using localStorage fallback for data storage")}}let c=!1;async function l(){c||(await i(),c=!0)}async function d(e){return await l(),(r?a:n).createRoom(e)}async function o(e,t){return await l(),(r?a:n).joinRoom(e,t)}async function h(e,t){return await l(),(r?a:n).setTargetPhrase(e,t)}async function m(e,t){return await l(),(r?a:n).submitAnswer(e,t)}async function x(e,t){return await l(),(r?a:n).updateTypingStatus(e,t)}async function u(e){return await l(),(r?a:n).leaveRoom(e)}async function g(e,t){return await l(),(r?a:n).subscribeToRoom(e,t)}async function p(){return await l(),(r?a:n).getCurrentUser()}},4889:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var r=s(5155),a=s(2115),n=s(5695),i=s(988),c=s(9434),l=s(5317),d=s(6104);let o="global-phrases";async function h(){try{let e=(0,l.doc)(d.db,"app-data",o),t=await (0,l.getDoc)(e);if(t.exists())return t.data().phrases||[];{let t=["The lecture was about climate change","Students should submit their assignments on time","The research findings were quite surprising","Technology has revolutionized modern education","Environmental protection is everyone's responsibility"];return await (0,l.setDoc)(e,{phrases:t}),t}}catch(e){return console.error("Error getting global phrases:",e),[]}}async function m(e){try{if(!d.j2.currentUser)throw Error("User not authenticated");let t=(0,l.doc)(d.db,"app-data",o),s=await h(),r=e.filter(e=>!s.includes(e));r.length>0&&await (0,l.updateDoc)(t,{phrases:(0,l.arrayUnion)(...r)})}catch(e){throw console.error("Error adding global phrases:",e),e}}async function x(e){try{if(!d.j2.currentUser)throw Error("User not authenticated");let t=(0,l.doc)(d.db,"app-data",o);await (0,l.updateDoc)(t,{phrases:(0,l.arrayRemove)(e)})}catch(e){throw console.error("Error removing global phrase:",e),e}}async function u(e){try{let t=d.j2.currentUser;if(!t)throw Error("User not authenticated");let s=(0,l.doc)(d.db,"rooms",e),r=await (0,l.getDoc)(s);if(!r.exists())throw Error("Room not found");let a=r.data();if(a.hostId!==t.uid)throw Error("Only host can set next phrase");let n=await h();if(0===n.length)throw Error("No phrases in global list");let i=((a.currentPhraseIndex||0)+1)%n.length,c=n[i],o={};Object.entries(a.participants).forEach(e=>{let[t,s]=e;o[t]={nickname:s.nickname,status:"waiting",isTyping:!1,correctCount:s.correctCount||0,totalAttempts:s.totalAttempts||0}}),await (0,l.updateDoc)(s,{targetPhrase:c,currentPhraseIndex:i,participants:o,isCountingDown:!0,countdownStartedAt:new Date,shouldPlayAudio:!0}),setTimeout(async()=>{try{await (0,l.updateDoc)(s,{isCountingDown:!1,roundStartTime:new Date,shouldPlayAudio:!1})}catch(e){console.error("Error stopping countdown:",e)}},3e3)}catch(e){throw console.error("Error setting next phrase:",e),e}}async function g(e){try{let t=d.j2.currentUser;if(!t)throw Error("User not authenticated");let s=(0,l.doc)(d.db,"rooms",e),r=await (0,l.getDoc)(s);if(!r.exists())throw Error("Room not found");if(r.data().hostId!==t.uid)throw Error("Only host can trigger audio playback");await (0,l.updateDoc)(s,{shouldPlayAudio:!0}),setTimeout(async()=>{try{await (0,l.updateDoc)(s,{shouldPlayAudio:!1})}catch(e){console.error("Error resetting audio flag:",e)}},1e3)}catch(e){throw console.error("Error triggering audio playback:",e),e}}async function p(e,t){try{let s=d.j2.currentUser;if(!s)throw Error("User not authenticated");let r=(0,l.doc)(d.db,"rooms",e),a=await (0,l.getDoc)(r);if(!a.exists())throw Error("Room not found");let n=a.data();if(n.hostId!==s.uid)throw Error("Only host can remove participants");if(t===s.uid)throw Error("Host cannot remove themselves");let i={...n.participants};delete i[t],await (0,l.updateDoc)(r,{participants:i})}catch(e){throw console.error("Error removing participant:",e),e}}function y(e){let{participants:t,currentUserId:s,isHost:n,roomId:i}=e,[l,d]=(0,a.useState)(null),o=async e=>{if(n&&e!==s){d(e);try{await p(i,e)}catch(e){console.error("Error removing participant:",e)}finally{d(null)}}};return(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Người tham gia (",t.length,")"]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Trạng th\xe1i thời gian thực"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[t.map(e=>(0,r.jsxs)("div",{className:"p-3 rounded-lg border transition-colors ".concat(e.id===s?"bg-primary-50 border-primary-200":"bg-gray-50 border-gray-200"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-xl",children:(e=>{switch(e){case"correct":return"✅";case"incorrect":return"❌";case"typing":return"⌨️";default:return"\uD83D\uDD53"}})(e.status)}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-gray-800",children:e.nickname}),e.id===s&&(0,r.jsx)("span",{className:"text-xs bg-primary-200 text-primary-700 px-2 py-1 rounded-full",children:"Bạn"}),n&&e.id!==s&&(0,r.jsx)("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full",children:"Th\xe0nh vi\xean"})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.submittedAt&&(0,r.jsxs)(r.Fragment,{children:["Gửi l\xfac ",(0,c.fU)(new Date(e.submittedAt))]})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("span",{className:(e=>{switch(e){case"correct":return"status-correct";case"incorrect":return"status-incorrect";case"typing":return"status-typing";default:return"status-waiting"}})(e.status),children:(e=>{switch(e){case"correct":return"Đ\xfang hết";case"incorrect":return"C\xf3 sai";case"typing":return"Đang g\xf5";default:return"Chờ"}})(e.status)}),e.accuracy&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.accuracy.accuracy.toFixed(1),"%"]})]}),n&&e.id!==s&&(0,r.jsx)("button",{onClick:()=>o(e.id),disabled:l===e.id,className:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:bg-red-400",title:"Loại khỏi ph\xf2ng",children:l===e.id?"...":"\uD83D\uDEAB"})]})]}),n&&e.accuracy&&e.submission&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-600 mb-2",children:[(0,r.jsx)("strong",{children:"C\xe2u trả lời:"}),' "',e.submission,'"']}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.accuracy.correct.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-green-600 font-medium",children:"Đ\xfang:"}),(0,r.jsx)("div",{className:"text-green-700",children:e.accuracy.correct.join(", ")})]}),e.accuracy.incorrect.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-red-600 font-medium",children:"Sai:"}),(0,r.jsx)("div",{className:"text-red-700",children:e.accuracy.incorrect.join(", ")})]}),e.accuracy.missing.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-orange-600 font-medium",children:"Thiếu:"}),(0,r.jsx)("div",{className:"text-orange-700",children:e.accuracy.missing.join(", ")})]}),e.accuracy.extra.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-purple-600 font-medium",children:"Thừa:"}),(0,r.jsx)("div",{className:"text-purple-700",children:e.accuracy.extra.join(", ")})]})]})]})]},e.id)),0===t.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDC65"}),(0,r.jsx)("p",{children:"Chưa c\xf3 người tham gia"})]})]}),n&&t.length>0&&(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Ch\xfa th\xedch:"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"✅"}),(0,r.jsx)("span",{children:"Đ\xfang hết"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"❌"}),(0,r.jsx)("span",{children:"C\xf3 sai"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"⌨️"}),(0,r.jsx)("span",{children:"Đang g\xf5"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDD53"}),(0,r.jsx)("span",{children:"Chờ"})]})]})]})]})}function j(e){let{room:t,participants:s,onSetTargetPhrase:n}=e,[i,c]=(0,a.useState)(""),[l,d]=(0,a.useState)([]),[o,p]=(0,a.useState)(""),[y,j]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),[v,N]=(0,a.useState)(!1),[w,C]=(0,a.useState)(""),[D,k]=(0,a.useState)(!1),[T,S]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let e=await h();d(e)}catch(e){console.error("Error loading global phrases:",e)}})()},[]);let P=async(e,t)=>{j(!0),f(t);try{await n(e)}catch(e){console.error("Error setting target phrase:",e)}finally{j(!1)}},E=async()=>{if(o.trim())try{await m([o.trim()]),p("");let e=await h();d(e)}catch(e){console.error("Error adding phrase:",e)}},F=async e=>{try{let t=l[e];await x(t);let s=await h();d(s),b===e?f(null):null!==b&&b>e&&f(b-1)}catch(e){console.error("Error removing phrase:",e)}},A=async()=>{if(w.trim()){j(!0);try{let e=w.split("\n").map(e=>e.trim()).filter(e=>e.length>0).filter(e=>e.length<=200);if(0===e.length)return;await m(e);let t=await h();d(t),C(""),N(!1)}catch(e){console.error("Error bulk adding phrases:",e)}finally{j(!1)}}},M=async e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){k(!0),S("");try{let t=await new Promise((e,t)=>{if(!s.name.toLowerCase().endsWith(".csv"))return void t(Error("Chỉ chấp nhận file CSV (.csv)"));if(s.size>5242880)return void t(Error("File qu\xe1 lớn (tối đa 5MB)"));let r=new FileReader;r.onload=s=>{var r;let a=null==(r=s.target)?void 0:r.result;if(!a)return void t(Error("Kh\xf4ng thể đọc file"));e(a)},r.onerror=()=>{t(Error("Lỗi khi đọc file"))},r.readAsText(s,"UTF-8")}),r=function(e){let t=e.split("\n"),s=[];for(let e=0;e<t.length;e++){let r=t[e].trim();if(!r)continue;let a="",n=!1,i=0;for(;i<r.length;){let e=r[i];if('"'===e)n=!n;else if(","!==e||n)(n||'"'!==e)&&(a+=e);else break;i++}(a=a.trim()).startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),a.length>0&&a.length<=200&&s.push(a)}return s}(t);if(0===r.length)return void S("Kh\xf4ng t\xecm thấy c\xe2u hợp lệ trong file CSV");await m(r);let a=await h();d(a),e.target.value="",console.log("✅ Đ\xe3 import ".concat(r.length," c\xe2u từ CSV"))}catch(e){S(e.message||"Lỗi khi import CSV"),console.error("CSV import error:",e)}finally{k(!1)}}},U=async()=>{if(0!==l.length){j(!0);try{await u(t.id)}catch(e){console.error("Error setting next phrase:",e)}finally{j(!1)}}},H=async()=>{try{await g(t.id)}catch(e){console.error("Error triggering audio playback:",e)}},I=s.length;s.filter(e=>"waiting"===e.status).length;let R=s.filter(e=>"typing"===e.status).length,W=s.filter(e=>"correct"===e.status||"incorrect"===e.status).length,L=s.filter(e=>"correct"===e.status).length;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quản l\xfd danh s\xe1ch c\xe2u WFD"}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-green-800",children:"\uD83D\uDCC4 Import từ file CSV"}),(0,r.jsx)("button",{onClick:()=>{let e,t=new Blob([(e="WFD Phrases\n",["The lecture was about climate change","Students should submit their assignments on time","The research findings were quite surprising","Technology has revolutionized modern education","Environmental protection is everyone's responsibility","The conference will be held next month","Please complete the survey by Friday","The new policy takes effect immediately","All participants must register in advance","The deadline has been extended until next week"].forEach(t=>{e+='"'.concat(t,'"\n')}),e)],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){let e=URL.createObjectURL(t);s.setAttribute("href",e),s.setAttribute("download","wfd-phrases-sample.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},className:"text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition-colors",children:"\uD83D\uDCE5 Tải file mẫu"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("input",{type:"file",accept:".csv",onChange:M,disabled:D,className:"text-sm text-gray-600 file:mr-3 file:py-1 file:px-3 file:rounded file:border-0 file:text-xs file:bg-green-600 file:text-white hover:file:bg-green-700 file:cursor-pointer"}),D&&(0,r.jsx)("div",{className:"text-xs text-green-600",children:"Đang import..."})]}),T&&(0,r.jsxs)("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:["❌ ",T]}),(0,r.jsxs)("div",{className:"text-xs text-green-700",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Hướng dẫn:"})," File CSV phải c\xf3 c\xe2u WFD ở cột đầu ti\xean, mỗi c\xe2u một d\xf2ng. Tải file mẫu để xem định dạng ch\xednh x\xe1c."]})]})]}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\xeam c\xe2u WFD:"}),(0,r.jsx)("button",{onClick:()=>N(!v),className:"text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors",children:v?"Th\xeam từng c\xe2u":"Th\xeam h\xe0ng loạt"})]}),v?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("textarea",{value:w,onChange:e=>C(e.target.value),placeholder:"Nhập nhiều c\xe2u WFD, mỗi c\xe2u một d\xf2ng:  The lecture was about climate change Students should submit their assignments on time Technology has revolutionized modern education",className:"input-field min-h-[120px] resize-none text-sm",maxLength:5e3}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[w.split("\n").filter(e=>e.trim()).length," c\xe2u sẽ được th\xeam"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{C("")},disabled:!w.trim(),className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors disabled:bg-gray-400",children:"X\xf3a hết"}),(0,r.jsx)("button",{onClick:A,disabled:!w.trim(),className:"btn-primary text-xs px-4 py-1",children:"Th\xeam tất cả"})]})]})]}):(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:o,onChange:e=>p(e.target.value),placeholder:"Nhập c\xe2u WFD mới...",className:"input-field flex-1",maxLength:200,onKeyPress:e=>"Enter"===e.key&&E()}),(0,r.jsx)("button",{onClick:E,disabled:!o.trim(),className:"btn-primary whitespace-nowrap",children:"Th\xeam"})]})]}),t.targetPhrase&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-primary-50 border border-primary-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("div",{className:"text-sm text-primary-600 font-medium",children:"\uD83C\uDFAF C\xe2u đang sử dụng:"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>(e=>{if("speechSynthesis"in window&&e){window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.rate=.8,t.volume=.8,t.pitch=1;let s=window.speechSynthesis.getVoices().find(e=>e.lang.startsWith("en")||e.name.toLowerCase().includes("english"));s&&(t.voice=s),window.speechSynthesis.speak(t)}})(t.targetPhrase),className:"text-xs bg-primary-600 text-white px-3 py-1 rounded hover:bg-primary-700 transition-colors",children:"\uD83D\uDD0A Host nghe"}),(0,r.jsx)("button",{onClick:H,className:"text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition-colors",children:"\uD83D\uDCE2 Ph\xe1t cho tất cả"}),(0,r.jsx)("button",{onClick:U,disabled:y||0===l.length,className:"text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:y?"Đang chuyển...":"⏭️ C\xe2u tiếp theo"})]})]}),(0,r.jsxs)("div",{className:"text-lg font-medium text-primary-800",children:['"',t.targetPhrase,'"']}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,r.jsx)("div",{className:"text-xs text-primary-600",children:"Người tham gia đang thực h\xe0nh với c\xe2u n\xe0y"}),void 0!==t.currentPhraseIndex&&l.length>0&&(0,r.jsxs)("div",{className:"text-xs text-primary-500",children:["C\xe2u ",t.currentPhraseIndex+1,"/",l.length]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Danh s\xe1ch c\xe2u WFD (",l.length," c\xe2u):"]}),0===l.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,r.jsx)("p",{children:"Chưa c\xf3 c\xe2u n\xe0o trong danh s\xe1ch"})]}):(0,r.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:l.map((e,s)=>(0,r.jsx)("div",{className:"p-3 border rounded-lg transition-colors ".concat(t.targetPhrase===e?"border-primary-300 bg-primary-50":"border-gray-200 bg-white hover:bg-gray-50"),children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-900 break-words",children:['"',e,'"']}),t.targetPhrase===e&&(0,r.jsx)("div",{className:"text-xs text-primary-600 mt-1 font-medium",children:"✓ Đang sử dụng"})]}),(0,r.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:()=>P(e,s),disabled:y||t.targetPhrase===e,className:"text-xs px-2 py-1 rounded transition-colors ".concat(t.targetPhrase===e?"bg-primary-200 text-primary-700 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:y&&b===s?"Đang đặt...":"Sử dụng"}),(0,r.jsx)("button",{onClick:()=>F(s),className:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"X\xf3a"})]})]})},s))})]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Thống k\xea thời gian thực"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:I}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Tổng số"})]}),(0,r.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:R}),(0,r.jsx)("div",{className:"text-sm text-blue-600",children:"Đang g\xf5"})]}),(0,r.jsxs)("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:W}),(0,r.jsx)("div",{className:"text-sm text-yellow-600",children:"Đ\xe3 gửi"})]}),(0,r.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:L}),(0,r.jsx)("div",{className:"text-sm text-green-600",children:"Đ\xfang hết"})]})]}),I>0&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,r.jsx)("span",{children:"Tiến độ ho\xe0n th\xe0nh"}),(0,r.jsxs)("span",{children:[W,"/",I]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(W/I*100,"%")}})})]}),W>0&&(0,r.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"T\xf3m tắt độ ch\xednh x\xe1c:"}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsxs)("div",{children:["• ",L," người đ\xfang ho\xe0n to\xe0n (",(L/W*100).toFixed(1),"%)"]}),(0,r.jsxs)("div",{children:["• ",W-L," người c\xf3 sai s\xf3t (",((W-L)/W*100).toFixed(1),"%)"]})]})]})]}),(0,r.jsxs)("div",{className:"card bg-primary-50 border-primary-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-800 mb-3",children:"Hướng dẫn cho Host"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-primary-700",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"1."}),(0,r.jsx)("span",{children:"Tạo danh s\xe1ch c\xe1c c\xe2u WFD để luyện tập"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"2."}),(0,r.jsx)("span",{children:"Chọn c\xe2u từ danh s\xe1ch để người tham gia thực h\xe0nh"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"3."}),(0,r.jsx)("span",{children:"Người tham gia sẽ kh\xf4ng thấy c\xe2u mẫu v\xe0 phải g\xf5 từ tr\xed nhớ"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"4."}),(0,r.jsx)("span",{children:"Theo d\xf5i trạng th\xe1i thời gian thực v\xe0 kết quả chi tiết"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"5."}),(0,r.jsx)("span",{children:"C\xf3 thể thay đổi c\xe2u bất cứ l\xfac n\xe0o để luyện tập li\xean tục"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"6."}),(0,r.jsx)("span",{children:'Sử dụng n\xfat "Ph\xe1t lại" để cho người tham gia nghe lại c\xe2u nếu cần'})]})]})]})]})}function b(e){let{targetPhrase:t,countdownStartedAt:s,onComplete:n}=e,[i,c]=(0,a.useState)(3),[l,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=s.getTime(),t=Math.max(0,3-Math.floor((Date.now()-e)/1e3));if(c(t),t<=0)return void n();let r=setInterval(()=>{let t=Math.max(0,3-Math.floor((Date.now()-e)/1e3));c(t),t<=0&&(clearInterval(r),n())},100);return()=>clearInterval(r)},[s,n]);let o=(0,a.useCallback)(()=>{if("speechSynthesis"in window&&t){d(!0),window.speechSynthesis.cancel();let e=new SpeechSynthesisUtterance(t);e.rate=.8,e.volume=.8,e.pitch=1;let s=window.speechSynthesis.getVoices().find(e=>e.lang.startsWith("en")||e.name.toLowerCase().includes("english"));s&&(e.voice=s),e.onend=()=>{d(!1)},e.onerror=()=>{d(!1)},window.speechSynthesis.speak(e)}},[t]);return(0,a.useEffect)(()=>{1!==i||l||o()},[i,l,o]),(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Chuẩn bị nghe c\xe2u mẫu"}),(0,r.jsx)("div",{className:"mx-auto w-32 h-32 rounded-full border-4 flex items-center justify-center mb-6 ".concat((()=>{switch(i){case 3:return"text-green-600 border-green-300 bg-green-50";case 2:return"text-yellow-600 border-yellow-300 bg-yellow-50";case 1:return"text-red-600 border-red-300 bg-red-50";default:return"text-gray-600 border-gray-300 bg-gray-50"}})()),children:(0,r.jsx)("div",{className:"text-6xl font-bold",children:i})}),(0,r.jsxs)("div",{className:"space-y-2 mb-6",children:[i>1&&(0,r.jsxs)("p",{className:"text-gray-600",children:["Đếm ngược ",i," gi\xe2y..."]}),1===i&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-red-600 font-semibold",children:"\uD83D\uDD0A Đang đọc c\xe2u mẫu..."}),l&&(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"animate-pulse w-2 h-2 bg-red-500 rounded-full"}),(0,r.jsx)("div",{className:"animate-pulse w-2 h-2 bg-red-500 rounded-full",style:{animationDelay:"0.2s"}}),(0,r.jsx)("div",{className:"animate-pulse w-2 h-2 bg-red-500 rounded-full",style:{animationDelay:"0.4s"}})]})]}),0===i&&(0,r.jsx)("p",{className:"text-green-600 font-semibold",children:"✅ Bắt đầu g\xf5 c\xe2u trả lời!"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:o,disabled:l,className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:l?"\uD83D\uDD0A Đang đọc...":"\uD83D\uDD0A Nghe lại"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"C\xe2u sẽ được đọc tự động khi đếm ngược đến 1"})]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"Hướng dẫn:"}),(0,r.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("p",{children:"• Nghe kỹ c\xe2u được đọc"}),(0,r.jsx)("p",{children:"• Ghi nhớ ch\xednh x\xe1c từng từ"}),(0,r.jsx)("p",{children:"• Sẵn s\xe0ng g\xf5 lại sau khi đếm ngược"})]})]})]})})}function f(e){let{room:t,currentUser:s,onSubmitAnswer:n,onTypingStatusChange:i}=e,[c,l]=(0,a.useState)(""),[d,o]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[x,u]=(0,a.useState)([]),g=t.participants[s.id],p=(null==g?void 0:g.status)==="submitted",y=null==g?void 0:g.accuracy;(0,a.useEffect)(()=>{if(m(p),t.targetPhrase&&!p){let e=x[x.length-1];e&&e.phrase===t.targetPhrase||(l(""),m(!1))}},[p,t.targetPhrase,x]),(0,a.useEffect)(()=>{t.shouldPlayAudio&&t.targetPhrase&&j(t.targetPhrase)},[t.shouldPlayAudio,t.targetPhrase]);let j=e=>{if("speechSynthesis"in window&&e){window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.rate=.8,t.volume=.8,t.pitch=1;let s=window.speechSynthesis.getVoices().find(e=>e.lang.startsWith("en")||e.name.toLowerCase().includes("english"));s&&(t.voice=s),window.speechSynthesis.speak(t)}};(0,a.useEffect)(()=>{if(p&&y&&y.isFullyCorrect&&t.targetPhrase&&(null==g?void 0:g.submission)){let e={phrase:t.targetPhrase,answer:g.submission,accuracy:y,timestamp:new Date};u(t=>t.some(t=>t.phrase===e.phrase&&t.answer===e.answer&&1e3>Math.abs(t.timestamp.getTime()-e.timestamp.getTime()))?t:[...t,e])}},[p,y,t.targetPhrase,null==g?void 0:g.submission]);let f=async()=>{if(c.trim()&&!d){o(!0);try{await n(c.trim()),i(!1)}catch(e){console.error("Error submitting answer:",e)}finally{o(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[t.isCountingDown&&t.countdownStartedAt&&t.targetPhrase&&(0,r.jsx)(b,{targetPhrase:t.targetPhrase,countdownStartedAt:t.countdownStartedAt,onComplete:()=>{console.log("Countdown completed")}}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Trạng th\xe1i của bạn"}),(0,r.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(h?(null==y?void 0:y.isFullyCorrect)?"bg-green-100 text-green-800":"bg-red-100 text-red-800":c.length>0?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:h?(null==y?void 0:y.isFullyCorrect)?"✅ Đ\xfang hết":"❌ C\xf3 sai":c.length>0?"⌨️ Đang g\xf5":"\uD83D\uDD53 Chờ"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[t.targetPhrase?(0,r.jsxs)("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-sm text-primary-600 font-medium mb-1",children:h?"✅ Đ\xe3 ho\xe0n th\xe0nh c\xe2u n\xe0y":"\uD83C\uDFAF C\xe2u hiện tại"}),(0,r.jsx)("div",{className:"text-primary-800",children:h?"Bạn đ\xe3 gửi c\xe2u trả lời. Chờ Host đặt c\xe2u mới để tiếp tục luyện tập.":"Host đ\xe3 đặt một c\xe2u mẫu. H\xe3y g\xf5 lại c\xe2u đ\xf3 từ tr\xed nhớ của bạn."}),(0,r.jsx)("div",{className:"text-xs text-primary-600 mt-2",children:"\uD83D\uDCA1 Bạn kh\xf4ng thể thấy c\xe2u mẫu. H\xe3y g\xf5 ch\xednh x\xe1c những g\xec bạn nhớ được."})]}):(0,r.jsxs)("div",{className:"text-center py-6 text-gray-500 bg-gray-50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"⏳"}),(0,r.jsx)("p",{children:"Đang chờ Host đặt c\xe2u mẫu..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"G\xf5 c\xe2u trả lời của bạn:"}),(0,r.jsx)("textarea",{value:c,onChange:e=>{var t;l(t=e.target.value),i(t.length>0&&!h)},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())},placeholder:t.targetPhrase?h?"Chờ c\xe2u mới từ Host...":"G\xf5 c\xe2u m\xe0 bạn nhớ được...":"Chờ Host đặt c\xe2u mẫu...",className:"input-field min-h-[120px] resize-none text-lg",disabled:d||!t.targetPhrase||h,maxLength:500}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[c.length,"/500 k\xfd tự"]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:!h&&t.targetPhrase&&"Nhấn Enter để gửi"})]})]}),(0,r.jsx)("button",{onClick:f,disabled:!c.trim()||d||!t.targetPhrase||h,className:"w-full btn-primary py-3 text-lg",children:d?"Đang gửi...":t.targetPhrase?h?"Đ\xe3 gửi - Chờ c\xe2u mới":"Gửi c\xe2u trả lời":"Chờ c\xe2u mẫu..."}),h&&y&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Kết quả c\xe2u vừa rồi:"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 rounded-lg text-center ".concat(y.isFullyCorrect?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:y.isFullyCorrect?"✅":"❌"}),(0,r.jsx)("div",{className:"text-lg font-semibold ".concat(y.isFullyCorrect?"text-green-800":"text-red-800"),children:y.isFullyCorrect?"Ho\xe0n hảo!":"C\xf3 sai s\xf3t"}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Độ ch\xednh x\xe1c: ",y.accuracy.toFixed(1),"%"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.correct.length>0&&(0,r.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,r.jsxs)("h4",{className:"font-medium text-green-800 mb-2",children:["✅ Từ đ\xfang (",y.correct.length,")"]}),(0,r.jsx)("div",{className:"text-sm text-green-700",children:y.correct.join(", ")})]}),y.incorrect.length>0&&(0,r.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg",children:[(0,r.jsxs)("h4",{className:"font-medium text-red-800 mb-2",children:["❌ Từ sai (",y.incorrect.length,")"]}),(0,r.jsx)("div",{className:"text-sm text-red-700",children:y.incorrect.join(", ")})]}),y.missing.length>0&&(0,r.jsxs)("div",{className:"p-3 bg-orange-50 rounded-lg",children:[(0,r.jsxs)("h4",{className:"font-medium text-orange-800 mb-2",children:["⚠️ Từ thiếu (",y.missing.length,")"]}),(0,r.jsx)("div",{className:"text-sm text-orange-700",children:y.missing.join(", ")})]}),y.extra.length>0&&(0,r.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,r.jsxs)("h4",{className:"font-medium text-purple-800 mb-2",children:["➕ Từ thừa (",y.extra.length,")"]}),(0,r.jsx)("div",{className:"text-sm text-purple-700",children:y.extra.join(", ")})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"C\xe2u trả lời của bạn:"}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 italic",children:['"',null==g?void 0:g.submission,'"']})]})]}),!y.isFullyCorrect&&(0,r.jsxs)("div",{className:"mt-4 text-center",children:[(0,r.jsx)("button",{onClick:()=>{l(""),m(!1),i(!1)},className:"btn-secondary px-6 py-2",children:"\uD83D\uDD04 Thử lại c\xe2u n\xe0y"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Bạn c\xf3 thể thử lại cho đến khi đ\xfang ho\xe0n to\xe0n"})]})]})]})]}),(0,r.jsxs)("div",{className:"card bg-blue-50 border-blue-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Hướng dẫn cho người tham gia"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-blue-700",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"1."}),(0,r.jsx)("span",{children:"Chờ Host đặt c\xe2u mẫu"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"2."}),(0,r.jsx)("span",{children:"G\xf5 lại c\xe2u đ\xf3 từ tr\xed nhớ (kh\xf4ng được xem c\xe2u gốc)"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"3."}),(0,r.jsx)("span",{children:"Hệ thống sẽ chấm điểm theo chuẩn PTE WFD"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"4."}),(0,r.jsx)("span",{children:"Nếu sai, bạn c\xf3 thể thử lại cho đến khi đ\xfang ho\xe0n to\xe0n"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"5."}),(0,r.jsx)("span",{children:"Chỉ c\xe2u đ\xfang 100% mới được lưu v\xe0o lịch sử"})]})]})]}),x.length>0&&(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Lịch sử luyện tập (",x.length," c\xe2u)"]}),(0,r.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:x.map((e,t)=>(0,r.jsxs)("div",{className:"p-4 border rounded-lg ".concat(e.accuracy.isFullyCorrect?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:e.accuracy.isFullyCorrect?"✅":"❌"}),(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-600",children:["C\xe2u #",x.length-t]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.accuracy.accuracy.toFixed(1),"% ch\xednh x\xe1c"]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 mb-2",children:[(0,r.jsx)("strong",{children:"C\xe2u gốc:"}),' "',e.phrase,'"']}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 mb-2",children:[(0,r.jsx)("strong",{children:"C\xe2u trả lời:"}),' "',e.answer,'"']}),!e.accuracy.isFullyCorrect&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-2",children:[e.accuracy.incorrect.length>0&&(0,r.jsxs)("span",{className:"text-red-600",children:["Sai: ",e.accuracy.incorrect.join(", ")]}),e.accuracy.missing.length>0&&(0,r.jsxs)("span",{className:"text-orange-600 ml-2",children:["Thiếu: ",e.accuracy.missing.join(", ")]}),e.accuracy.extra.length>0&&(0,r.jsxs)("span",{className:"text-purple-600 ml-2",children:["Thừa: ",e.accuracy.extra.join(", ")]})]})]},t))})]}),(0,r.jsxs)("div",{className:"card bg-yellow-50 border-yellow-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-3",children:"\uD83D\uDCA1 Mẹo cho PTE Write From Dictation"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-yellow-700",children:[(0,r.jsxs)("div",{children:["• ",(0,r.jsx)("strong",{children:"Nghe kỹ:"})," Tập trung v\xe0o từng từ"]}),(0,r.jsxs)("div",{children:["• ",(0,r.jsx)("strong",{children:"Ghi nhớ:"})," Nhớ thứ tự v\xe0 ch\xednh tả"]}),(0,r.jsxs)("div",{children:["• ",(0,r.jsx)("strong",{children:"Viết ch\xednh x\xe1c:"})," Mỗi từ sai sẽ bị trừ điểm"]}),(0,r.jsxs)("div",{children:["• ",(0,r.jsx)("strong",{children:"Kiểm tra:"})," Đọc lại trước khi gửi"]}),(0,r.jsxs)("div",{children:["• ",(0,r.jsx)("strong",{children:"Luyện tập li\xean tục:"})," Khung nhập lu\xf4n sẵn s\xe0ng cho c\xe2u tiếp theo"]})]})]})]})]})}function v(){return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Đang tải..."})]})}function N(e){let{participants:t,hostId:s,currentUserId:a}=e,n=Object.entries(t).map(e=>{let[t,r]=e;return{id:t,nickname:r.nickname,correctCount:r.correctCount||0,totalAttempts:r.totalAttempts||0,accuracy:r.totalAttempts>0?(r.correctCount||0)/r.totalAttempts*100:0,averageTime:r.averageTime||0,fastestTime:r.fastestTime||0,isHost:t===s}}).sort((e,t)=>t.correctCount!==e.correctCount?t.correctCount-e.correctCount:e.correctCount>0&&t.correctCount>0?e.averageTime!==t.averageTime?e.averageTime-t.averageTime:e.fastestTime-t.fastestTime:t.accuracy-e.accuracy);return(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\uD83C\uDFC6 Bảng xếp hạng thời gian thực"}),0===n.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCA"}),(0,r.jsx)("p",{children:"Chưa c\xf3 dữ liệu xếp hạng"})]}):(0,r.jsx)("div",{className:"space-y-2",children:n.map((e,t)=>{let s=t+1,n=e.id===a;return(0,r.jsx)("div",{className:"p-3 border rounded-lg transition-colors ".concat(n?"border-primary-300 bg-primary-50":(e=>{switch(e){case 1:return"text-yellow-600 bg-yellow-50 border-yellow-200";case 2:default:return"text-gray-600 bg-gray-50 border-gray-200";case 3:return"text-orange-600 bg-orange-50 border-orange-200"}})(s)),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"text-lg font-bold min-w-[40px]",children:(e=>{switch(e){case 1:return"\uD83E\uDD47";case 2:return"\uD83E\uDD48";case 3:return"\uD83E\uDD49";default:return"#".concat(e)}})(s)}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium ".concat(n?"text-primary-800":"text-gray-800"),children:e.nickname}),e.isHost&&(0,r.jsx)("span",{className:"text-xs bg-primary-600 text-white px-2 py-1 rounded",children:"Host"}),n&&(0,r.jsx)("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded",children:"Bạn"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[e.correctCount," c\xe2u đ\xfang / ",e.totalAttempts," lần thử",e.totalAttempts>0&&(0,r.jsxs)("span",{className:"ml-2",children:["(",e.accuracy.toFixed(1),"% ch\xednh x\xe1c)"]}),e.correctCount>0&&e.averageTime>0&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["⚡ TB: ",(e.averageTime/1e3).toFixed(1),"s",e.fastestTime>0&&(0,r.jsxs)("span",{className:"ml-2",children:["\uD83D\uDE80 Nhanh nhất: ",(e.fastestTime/1e3).toFixed(1),"s"]})]})]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(n?"text-primary-600":"text-gray-700"),children:e.correctCount}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"điểm"})]})]})},e.id)})}),n.length>0&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-bold text-gray-800",children:n.reduce((e,t)=>e+t.correctCount,0)}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Tổng c\xe2u đ\xfang"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-bold text-gray-800",children:n.reduce((e,t)=>e+t.totalAttempts,0)}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Tổng lần thử"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-gray-800",children:[n.length>0?(n.reduce((e,t)=>e+t.accuracy,0)/n.length).toFixed(1):0,"%"]}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Độ ch\xednh x\xe1c TB"})]})]})})]})}function w(e){let{roomId:t,currentUserId:s,isHost:n}=e,[i,c]=(0,a.useState)({isMuted:!0,isRecording:!1,hasPermission:!1,error:null}),[l,d]=(0,a.useState)(!1),o=(0,a.useRef)(null),h=(0,a.useRef)(null),m=(0,a.useRef)(null),[x,u]=(0,a.useState)(0),g=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});return o.current=e,c(e=>({...e,hasPermission:!0,error:null})),p(e),!0}catch(e){return console.error("Microphone permission denied:",e),c(e=>({...e,hasPermission:!1,error:"Kh\xf4ng thể truy cập microphone. Vui l\xf2ng cho ph\xe9p quyền truy cập."})),!1}},p=e=>{try{let t=new(window.AudioContext||window.webkitAudioContext),s=t.createAnalyser(),r=t.createMediaStreamSource(e);s.fftSize=256,r.connect(s),h.current=t,m.current=s,y()}catch(e){console.error("Error setting up audio analysis:",e)}},y=()=>{if(!m.current)return;let e=new Uint8Array(m.current.frequencyBinCount),t=()=>{m.current&&(m.current.getByteFrequencyData(e),u(e.reduce((e,t)=>e+t)/e.length),i.isMuted||requestAnimationFrame(t))};t()},j=async()=>{(i.hasPermission||await g())&&o.current&&(o.current.getAudioTracks().forEach(e=>{e.enabled=i.isMuted}),c(e=>({...e,isMuted:!e.isMuted,isRecording:!e.isMuted})),i.isMuted||y())};return(0,a.useEffect)(()=>()=>{o.current&&o.current.getTracks().forEach(e=>e.stop()),h.current&&h.current.close()},[]),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\uD83C\uDF99️ Voice Chat"}),(0,r.jsx)("button",{onClick:()=>d(!l),className:"text-sm text-gray-600 hover:text-gray-800",children:l?"▼":"▶"})]}),l&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("button",{onClick:j,className:"p-3 rounded-full text-white transition-colors ".concat(i.error?"bg-red-600 hover:bg-red-700":!i.hasPermission||i.isMuted?"bg-gray-600 hover:bg-gray-700":"bg-green-600 hover:bg-green-700"),title:i.error?"Lỗi microphone":i.hasPermission?i.isMuted?"Click để bật microphone":"Click để tắt microphone":"Click để cho ph\xe9p microphone",children:(0,r.jsx)("span",{className:"text-xl",children:i.error?"❌":i.hasPermission&&i.isMuted?"\uD83D\uDD07":"\uD83C\uDFA4"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-700",children:i.error?"Lỗi microphone":i.hasPermission?i.isMuted?"Microphone đ\xe3 tắt":"Microphone đang bật":"Chưa c\xf3 quyền truy cập microphone"}),!i.isMuted&&i.hasPermission&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-100",style:{width:"".concat(Math.min(2*x,100),"%")}})}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Mức \xe2m thanh"})]})]})]}),i.error&&(0,r.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,r.jsx)("div",{className:"text-sm text-red-800",children:i.error}),(0,r.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"Vui l\xf2ng kiểm tra c\xe0i đặt tr\xecnh duyệt v\xe0 cho ph\xe9p quyền truy cập microphone."})]}),(0,r.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"Hướng dẫn sử dụng Voice Chat:"}),(0,r.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("p",{children:"• Click v\xe0o n\xfat microphone để bật/tắt"}),(0,r.jsx)("p",{children:"• Thanh m\xe0u xanh hiển thị mức \xe2m thanh của bạn"}),(0,r.jsxs)("p",{children:["• ",n?"Bạn c\xf3 thể n\xf3i chuyện với tất cả participants":"Bạn c\xf3 thể n\xf3i chuyện với host v\xe0 participants kh\xe1c"]}),(0,r.jsx)("p",{children:"• Sử dụng để hỏi đ\xe1p, thảo luận về b\xe0i tập"})]})]}),(0,r.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Trạng th\xe1i:"}),(0,r.jsx)("span",{className:"font-medium ".concat(!i.isMuted&&i.hasPermission?"text-green-600":"text-gray-600"),children:!i.isMuted&&i.hasPermission?"\uD83D\uDFE2 Đang kết nối":"\uD83D\uDD34 Kh\xf4ng kết nối"})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"\uD83D\uDCA1 T\xednh năng n\xe0y cho ph\xe9p giao tiếp voice real-time trong ph\xf2ng"})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{o.current&&(o.current.getTracks().forEach(e=>e.stop()),o.current=null),c({isMuted:!0,isRecording:!1,hasPermission:!1,error:null})},className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Reset Audio"}),(0,r.jsx)("button",{onClick:g,disabled:i.hasPermission,className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:"Test Microphone"})]})]})]})}function C(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),s=e.roomId,[l,d]=(0,a.useState)(null),[o,h]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[u,g]=(0,a.useState)(""),[p,b]=(0,a.useState)(!1),C=(0,a.useCallback)(e=>{(0,c.sg)(e=>{s&&(0,i.rh)(s,e)},300)(e)},[s]);(0,a.useEffect)(()=>{if(!s)return;let e=null;return(async()=>{try{e=await (0,i.fp)(s,async e=>{if(e){let s=await (0,i.HW)();if(s){let r=e.participants[s.id];if(!r)return void t.push("/?removed=true");h({...s,nickname:r.nickname,isHost:e.hostId===s.id}),b(e.hostId===s.id)}d(e),x(!1)}else g("Ph\xf2ng kh\xf4ng tồn tại hoặc đ\xe3 bị x\xf3a"),x(!1)})}catch(e){g("Kh\xf4ng thể kết nối đến ph\xf2ng"),x(!1)}})(),()=>{e&&e()}},[s,t]);let D=async e=>{try{await (0,i.jy)(s,e)}catch(e){g(e.message||"Kh\xf4ng thể đặt c\xe2u mẫu")}},k=async e=>{try{await (0,i.Jx)(s,e)}catch(e){g(e.message||"Kh\xf4ng thể gửi c\xe2u trả lời")}},T=async()=>{try{await (0,i.JP)(s),t.push("/")}catch(e){console.error("Error leaving room:",e),t.push("/")}};if(m)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white flex items-center justify-center",children:(0,r.jsx)(v,{})});if(u||!l||!o)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"card max-w-md w-full text-center",children:[(0,r.jsx)("div",{className:"text-red-600 text-6xl mb-4",children:"⚠️"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"C\xf3 lỗi xảy ra"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:u||"Kh\xf4ng thể tải th\xf4ng tin ph\xf2ng"}),(0,r.jsx)("button",{onClick:()=>t.push("/"),className:"btn-primary",children:"Về trang chủ"})]})});let S=Object.entries(l.participants).map(e=>{let[t,s]=e;return{id:t,nickname:s.nickname,submission:s.submission,accuracy:s.accuracy,submittedAt:s.submittedAt,isTyping:s.isTyping,status:(0,c.CD)(s)}});return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white",children:[(0,r.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-primary-600",children:"Ph\xf2ng luyện đ\xe1nh m\xe1y"}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["M\xe3 ph\xf2ng: ",(0,r.jsx)("span",{className:"font-mono font-semibold",children:s})]}),(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(s)},className:"text-xs bg-primary-100 text-primary-600 px-2 py-1 rounded hover:bg-primary-200 transition-colors",children:"Sao ch\xe9p"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:p?"\uD83C\uDFAF Host":"\uD83D\uDC64 Người tham gia"}),(0,r.jsx)("div",{className:"font-semibold text-primary-600",children:o.nickname})]}),(0,r.jsx)("button",{onClick:T,className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Rời ph\xf2ng"})]})]})})}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-4 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsx)(y,{participants:S,currentUserId:o.id,isHost:p,roomId:l.id})}),(0,r.jsx)("div",{className:"xl:col-span-2 lg:col-span-2",children:p?(0,r.jsx)(j,{room:l,participants:S,onSetTargetPhrase:D}):(0,r.jsx)(f,{room:l,currentUser:o,onSubmitAnswer:k,onTypingStatusChange:e=>{C(e)}})}),(0,r.jsx)("div",{className:"xl:col-span-1 lg:col-span-3 xl:col-start-4",children:(0,r.jsx)(N,{participants:l.participants,hostId:l.hostId,currentUserId:o.id})})]})}),(0,r.jsx)("div",{className:"fixed bottom-4 left-4 w-80 z-40",children:(0,r.jsx)(w,{roomId:s,currentUserId:o.id,isHost:p})}),u&&(0,r.jsx)("div",{className:"fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"mr-2",children:"⚠️"}),(0,r.jsx)("span",{children:u}),(0,r.jsx)("button",{onClick:()=>g(""),className:"ml-4 text-red-500 hover:text-red-700",children:"✕"})]})})]})}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},6104:(e,t,s)=>{"use strict";s.d(t,{av:()=>d,db:()=>c,j2:()=>l});var r=s(3915),a=s(5317),n=s(6203);let i=null,c=null,l=null;try{i=(0,r.Wp)({apiKey:"AIzaSyC7LWF3rfk0K8l5BTjAxjHSmQotkOlJIt4",authDomain:"wfdpracticeroom.firebaseapp.com",projectId:"wfdpracticeroom",storageBucket:"wfdpracticeroom.firebasestorage.app",messagingSenderId:"998166005854",appId:"1:998166005854:web:c0a2e365b5d0cd6c4b0ccf",measurementId:"G-2Z5WQPZK2R"}),c=(0,a.getFirestore)(i),l=(0,n.xI)(i),Promise.resolve().then(s.bind(s,5317)).then(e=>{let{enableNetwork:t,disableNetwork:s}=e;t(c).catch(console.warn)}),console.log("✅ Firebase initialized successfully")}catch(e){throw console.error("❌ Firebase initialization failed:",e),e}async function d(){try{if(!l)return!1;return new Promise(e=>{let t=l.onAuthStateChanged(()=>{t(),e(!0)},()=>{t(),e(!1)});setTimeout(()=>{t(),e(!1)},5e3)})}catch(e){return console.error("Firebase connection check failed:",e),!1}}},7293:(e,t,s)=>{Promise.resolve().then(s.bind(s,4889))},9434:(e,t,s)=>{"use strict";function r(e,t){let s=e=>e.trim().toLowerCase().replace(/\s+/g," "),r=s(e),a=s(t),n=r.split(" ").filter(e=>e.length>0),i=a.split(" ").filter(e=>e.length>0),c=[],l=[],d=[],o=[],h=new Map,m=new Map;n.forEach(e=>{h.set(e,(h.get(e)||0)+1)}),i.forEach(e=>{m.set(e,(m.get(e)||0)+1)}),h.forEach((e,t)=>{let s=Math.min(e,m.get(t)||0);for(let e=0;e<s;e++)c.push(t)}),h.forEach((e,t)=>{let s=Math.max(0,e-(m.get(t)||0));for(let e=0;e<s;e++)d.push(t)}),m.forEach((e,t)=>{let s=Math.max(0,e-(h.get(t)||0));for(let e=0;e<s;e++)o.push(t)}),i.forEach(e=>{h.has(e)||l.push(e)});let x=n.length,u=c.length,g=0===d.length&&0===l.length&&0===o.length;return{correct:c,incorrect:l,missing:d,extra:o,isFullyCorrect:g,accuracy:Math.round(100*(x>0?u/x*100:0))/100}}function a(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let s=0;s<6;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function n(e){return e.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function i(e){if("submitted"===e.status){var t;return(null==(t=e.accuracy)?void 0:t.isFullyCorrect)?"correct":"incorrect"}return e.status}function c(e,t){let s;return function(){for(var r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];clearTimeout(s),s=setTimeout(()=>e(...a),t)}}s.d(t,{CD:()=>i,S:()=>a,cG:()=>r,fU:()=>n,sg:()=>c})}},e=>{e.O(0,[992,811,645,441,964,358],()=>e(e.s=7293)),_N_E=e.O()}]);